<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>ÙƒÙˆØ¯ Ù†ÙŠÙ…Ø² Ø£ÙˆÙ†Ù„Ø§ÙŠÙ† Ø¨Ø¯ÙˆÙ† Ø³ÙŠØ±ÙØ±</title>
<style>
  body {
    font-family: "Segoe UI", Tahoma, Geneva, Verdana, sans-serif;
    background: #121212;
    color: #eee;
    margin: 0;
    padding: 0;
    user-select: none;
    display: flex;
    flex-direction: column;
    align-items: center;
  }
  header {
    background: #222;
    width: 100%;
    padding: 1rem;
    font-size: 1.7rem;
    font-weight: bold;
    text-align: center;
  }
  #setup, #game {
    max-width: 900px;
    width: 100%;
    margin: 1rem;
  }
  button {
    padding: 10px 20px;
    margin: 0.3rem;
    background: #333;
    border: none;
    border-radius: 6px;
    color: #eee;
    font-weight: bold;
    cursor: pointer;
    transition: background 0.3s;
  }
  button:hover {
    background: #555;
  }
  #board {
    display: grid;
    grid-template-columns: repeat(5, 1fr);
    gap: 6px;
    margin-top: 20px;
  }
  .card {
    background: #222;
    padding: 10px;
    border-radius: 7px;
    font-size: 1.1rem;
    cursor: pointer;
    min-height: 60px;
    display: flex;
    align-items: center;
    justify-content: center;
    user-select: none;
    transition: background-color 0.3s, color 0.3s;
  }
  .card.revealed.red {
    background-color: #c0392b;
    color: #fff;
    cursor: default;
  }
  .card.revealed.blue {
    background-color: #2980b9;
    color: #fff;
    cursor: default;
  }
  .card.revealed.neutral {
    background-color: #7f8c8d;
    color: #222;
    cursor: default;
  }
  .card.revealed.assassin {
    background-color: #000;
    color: #e74c3c;
    font-weight: bold;
    cursor: default;
  }
  #status {
    margin-top: 1rem;
    font-size: 1.3rem;
    font-weight: bold;
    min-height: 2rem;
  }
  #linkBox {
    margin-top: 1rem;
    word-break: break-all;
    background: #333;
    padding: 10px;
    border-radius: 5px;
    user-select: all;
    white-space: pre-wrap;
  }
</style>
</head>
<body>

<header>ÙƒÙˆØ¯ Ù†ÙŠÙ…Ø² Ø£ÙˆÙ†Ù„Ø§ÙŠÙ† Ø¨Ø¯ÙˆÙ† Ø³ÙŠØ±ÙØ± (Ø´Ø§Ø±Ùƒ Ø§Ù„Ø±Ø§Ø¨Ø· Ù…Ø¹ Ø±Ø¨Ø¹Ùƒ)</header>

<div id="setup">
  <button id="newGameBtn">Ø³ÙˆÙŠ Ù„Ø¹Ø¨Ø© Ø¬Ø¯ÙŠØ¯Ø©</button>
  <div id="linkBox" style="display:none;"></div>
</div>

<div id="game" style="display:none;">
  <div id="status"></div>
  <div id="board"></div>
  <button id="restartBtn">Ø¥Ø¹Ø§Ø¯Ø© Ø§Ù„Ù„Ø¹Ø¨ Ø¨Ù†ÙØ³ Ø§Ù„Ø±ÙˆÙ…</button>
  <button id="backBtn">Ø±Ø¬ÙˆØ¹ Ù„Ù„ØµÙØ­Ø© Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©</button>
</div>

<script>
  // ÙƒÙ„Ù…Ø§Øª ÙƒØ«ÙŠØ±Ø© Ù„Ù„Ø¹Ø¨Ø©
  const wordsPool = [
    "Ù‚Ù…Ø±","Ø´Ù…Ø³","Ù†Ø¬Ù…","Ø¨Ø­Ø±","ØµØ­Ø±Ø§Ø¡","Ø¬Ø¨Ù„","Ø³ÙŠØ§Ø±Ø©","Ø¨ÙŠØª","Ù‚Ù„Ù…","ÙƒØªØ§Ø¨",
    "Ù‡Ø§ØªÙ","ÙƒÙ…Ø¨ÙŠÙˆØªØ±","ÙƒØ±Ø©","Ù…Ø§Ø¡","Ù†Ø§Ø±","Ø±ÙŠØ­","Ø´Ø¬Ø±Ø©","Ø·Ø§Ø¦Ø±Ø©","Ø¯Ø±Ø§Ø¬Ø©","Ù†Ø§ÙØ°Ø©",
    "Ù‚Ø·Ø©","ÙƒÙ„Ø¨","Ø³Ù…ÙƒØ©","Ø·ÙŠÙˆØ±","Ø³Ù…Ø§Ø¡","Ø­ØµØ§Ù†","Ù†Ù‡Ø±","Ø³ÙÙŠÙ†Ø©","ØµØ§Ø±ÙˆØ®","Ù…Ø¯Ø±Ø³Ø©",
    "Ù…Ø·Ø¨Ø®","Ø­Ø¯ÙŠÙ‚Ø©","Ù‚Ø§Ø±Ø¨","Ø¬Ø³Ø±","Ø´Ø§Ø±Ø¹","Ù…ÙØªØ§Ø­","Ø¨Ø§Ø¨","Ø±Ø§Ø¯ÙŠÙˆ","Ø¯Ø¨Ø§Ø¨Ø©","ØªÙ…Ø³Ø§Ø­",
    "Ù†Ø¸Ø§Ø±Ø©","Ù‡Ù„Ø§Ù„","Ø¨Ø±ÙƒØ§Ù†","Ø¬ÙˆØ§Ù„","Ø·Ø§ÙˆÙ„Ø©","Ù…ÙƒØªØ¨Ø©","Ù…Ø¯ÙŠÙ†Ø©","Ù…Ø·Ø§Ø±","Ù‚Ø·Ø§Ø±","Ø¬Ø±ÙŠØ¯Ø©",
    "Ø´Ø¨Ø§Ùƒ","Ø®ÙŠÙ…Ø©","Ù…Ø·Ø±","Ø«Ø¹Ù„Ø¨","Ø°Ø¦Ø¨","Ø³Ù„Ø­ÙØ§Ø©","Ù†Ø­Ù„Ø©","ÙÙŠÙ„","Ø£Ø³Ø¯","Ù†Ù…Ø±",
    "Ø¨Ø§Ù†Ø¯Ø§","Ø²Ø±Ø§ÙØ©","ØªÙ…Ø§Ø³ÙŠØ­","Ù‚Ø±Ø´","Ø³Ù…Ùƒ","Ù…Ø·Ø§Ø±Ù‚","Ù…Ù‚Øµ","Ø³ÙƒØ§ÙƒÙŠÙ†","Ù…Ø¹Ø¬ÙˆÙ†","ÙØ±Ø´Ø§Ø©",
    "Ø³ÙŠØ§Ø±Ø© Ø³Ø¨Ø§Ù‚","ÙƒØ±Ø© Ù‚Ø¯Ù…","Ø´Ø·Ø±Ù†Ø¬","Ø¨Ø§Øµ","Ù…ÙƒÙˆØ§Ø©","Ù…Ø±ÙˆØ­Ø©","Ø³Ø§Ø¹Ø©","ÙƒØ§Ù…ÙŠØ±Ø§","Ø¯Ø¨","Ø³Ù„Ø·Ø§Ù†",
    "Ø®Ø¨Ø²","Ø²ÙŠØª","Ø³ÙƒØ±","Ù…Ù„Ø­","Ø¬Ø¨Ù†","Ù„Ø­Ù…","Ø­Ù„ÙŠØ¨","Ø¨ÙŠØ¶","Ø¨Ø±ØªÙ‚Ø§Ù„","ØªÙØ§Ø­",
    "ÙˆØ±Ø¯Ø©","Ø¹Ù†Ø¨","Ø®ÙˆØ®","ÙƒØ±Ø²","Ø¨Ø·ÙŠØ®","Ø´Ù…Ø§Ù…","Ù…ÙˆØ²","Ø£Ù†Ø§Ù†Ø§Ø³","ÙØ±Ø§ÙˆÙ„Ø©",
    "ÙƒÙˆØ¨","Ù…Ø¹Ù„Ù‚Ø©","Ø´ÙˆÙƒØ©","Ø³ÙƒÙŠÙ†","Ø·Ø¨Ù‚","Ù…Ù‚Ù„Ø§Ø©","ÙØ±Ù†","Ø«Ù„Ø§Ø¬Ø©","ØºØ³Ø§Ù„Ø©","Ù…Ø±ÙˆØ­Ø©",
    "Ù…ØµØ¨Ø§Ø­","ÙƒÙ‡Ø±Ø¨Ø§Ø¡","Ø¨Ø·Ø§Ø±ÙŠØ©","Ù‡Ø§ØªÙ Ø°ÙƒÙŠ","Ø­Ø§Ø³ÙˆØ¨ Ù…Ø­Ù…ÙˆÙ„","ØªØ§Ø¨Ù„Øª","ÙƒØ§Ù…ÙŠØ±Ø§ Ø±Ù‚Ù…ÙŠØ©","Ù…ÙŠÙƒØ±ÙˆÙÙˆÙ†","Ø³Ù…Ø§Ø¹Ø©","Ù…ÙƒØ¨Ø± ØµÙˆØª",
    "ÙƒØªØ§Ø¨ Ù…Ù‚Ø¯Ø³","Ø¬Ø±ÙŠØ¯Ø© Ù‚Ø¯ÙŠÙ…Ø©","Ù…Ø°ÙƒØ±Ø©","Ø¯ÙØªØ±","Ù‚Ù„Ù… Ø±ØµØ§Øµ","Ù‚Ù„Ù… Ø­Ø¨Ø±","Ù…Ø³Ø·Ø±Ø©","Ù…Ù…Ø­Ø§Ø©","Ø¹Ù„Ø¨Ø© Ø£Ù„ÙˆØ§Ù†","Ù„ÙˆØ­Ø© ÙÙ†ÙŠØ©",
    "Ø¨Ø­ÙŠØ±Ø©","Ø´Ù„Ø§Ù„","ØºØ§Ø¨Ø©","ÙˆØ§Ø¯ÙŠ","ÙƒÙ‡Ù","Ø´Ø§Ø·Ø¦","Ù…Ø±Ø¬",
    "Ø­Ø°Ø§Ø¡","Ù‚Ù…ÙŠØµ","Ø¨Ù†Ø·Ø§Ù„","Ø¬Ø§ÙƒÙŠØª","Ù‚Ø¨Ø¹Ø©","Ù†Ø¸Ø§Ø±Ø© Ø´Ù…Ø³","Ø³Ø§Ø¹Ø© ÙŠØ¯","Ø­Ø²Ø§Ù…","Ø­Ù‚ÙŠØ¨Ø©","Ù…Ø¸Ù„Ø©"
  ];

  // Ù…ØªØºÙŠØ±Ø§Øª Ø§Ù„Ù„Ø¹Ø¨Ø©
  let board = [];
  let turn = 'red'; // Ø§Ù„Ø£Ø­Ù…Ø± ÙŠØ¨Ø¯Ø£
  let redLeft = 9;
  let blueLeft = 8;
  let gameEnded = false;
  let roomId = null;

  // Ø¹Ù†Ø§ØµØ± DOM
  const newGameBtn = document.getElementById('newGameBtn');
  const linkBox = document.getElementById('linkBox');
  const setupDiv = document.getElementById('setup');
  const gameDiv = document.getElementById('game');
  const statusDiv = document.getElementById('status');
  const boardDiv = document.getElementById('board');
  const restartBtn = document.getElementById('restartBtn');
  const backBtn = document.getElementById('backBtn');

  // ØªÙˆÙ„ÙŠØ¯ ID Ø¹Ø´ÙˆØ§Ø¦ÙŠ Ù„Ù„Ø±ÙˆÙ…
  function generateRoomId() {
    return Math.random().toString(36).substring(2, 10);
  }

  // Ø®Ù„Ø· Ù…ØµÙÙˆÙØ©
  function shuffle(array) {
    for(let i=array.length-1; i>0; i--){
      const j = Math.floor(Math.random() * (i+1));
      [array[i], array[j]] = [array[j], array[i]];
    }
    return array;
  }

  // ØªÙˆÙ„ÙŠØ¯ Ø§Ù„ÙƒÙ„Ù…Ø§Øª Ù…Ø¹ Ø§Ù„Ø£Ù†ÙˆØ§Ø¹
  function generateBoard() {
    const shuffledWords = shuffle([...wordsPool]).slice(0, 25);

    let types = [];
    for(let i=0; i<9; i++) types.push('red');
    for(let i=0; i<8; i++) types.push('blue');
    for(let i=0; i<7; i++) types.push('neutral');
    types.push('assassin');
    shuffle(types);

    board = [];
    for(let i=0; i<25; i++) {
      board.push({
        word: shuffledWords[i],
        type: types[i],
        revealed: false
      });
    }
  }

  // Ø­ÙØ¸ Ø­Ø§Ù„Ø© Ø§Ù„Ø±ÙˆÙ… ÙÙŠ localStorage
  function saveRoom() {
    if (!roomId) return;
    const roomData = {
      board,
      turn,
      redLeft,
      blueLeft,
      gameEnded
    };
    localStorage.setItem('codenames_room_' + roomId, JSON.stringify(roomData));
  }

  // ØªØ­Ù…ÙŠÙ„ Ø­Ø§Ù„Ø© Ø§Ù„Ø±ÙˆÙ… Ù…Ù† localStorage
  function loadRoom(id) {
    const data = localStorage.getItem('codenames_room_' + id);
    if (!data) return false;
    try {
      const obj = JSON.parse(data);
      board = obj.board;
      turn = obj.turn;
      redLeft = obj.redLeft;
      blueLeft = obj.blueLeft;
      gameEnded = obj.gameEnded;
      return true;
    } catch {
      return false;
    }
  }

  // Ø¹Ø±Ø¶ Ø§Ù„ÙƒÙ„Ù…Ø§Øª
  function renderBoard() {
    boardDiv.innerHTML = '';
    board.forEach((card, i) => {
      const div = document.createElement('div');
      div.classList.add('card');
      if (card.revealed) {
        div.classList.add('revealed', card.type);
      }
      div.textContent = card.word;
      div.onclick = () => {
        if (gameEnded) return;
        if (card.revealed) return;

        card.revealed = true;
        updateCounts(card.type);
        if(card.type === 'assassin') {
          gameEnded = true;
          alert(`Ø®Ø³Ø± Ø§Ù„ÙØ±ÙŠÙ‚ ${turn.toUpperCase()} Ù„Ø£Ù† ÙƒØ´Ù Ø§Ù„ÙƒÙ„Ù…Ø© Ø§Ù„Ù‚Ø§ØªÙ„Ø©!`);
          statusDiv.textContent = `Ø§Ù†ØªÙ‡Øª Ø§Ù„Ù„Ø¹Ø¨Ø©. Ø§Ù„ÙØ±ÙŠÙ‚ ${turn.toUpperCase()} Ø®Ø³Ø±!`;
          saveRoom();
          return;
        }
        renderBoard();
      };
      boardDiv.appendChild(div);
    });
  }

  // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¹Ø¯Ø§Ø¯Ø§Øª ÙˆØ§Ù„Ø¯ÙˆØ±
  function updateCounts(clickedType) {
    if (clickedType === 'red') {
      redLeft--;
      if (redLeft === 0) {
        gameEnded = true;
        alert("Ø§Ù„ÙØ±ÙŠÙ‚ Ø§Ù„Ø£Ø­Ù…Ø± ÙØ§Ø²! Ù…Ø¨Ø±ÙˆÙƒ!");
        statusDiv.textContent = "Ø§Ù†ØªÙ‡Øª Ø§Ù„Ù„Ø¹Ø¨Ø©. Ø§Ù„ÙØ±ÙŠÙ‚ Ø§Ù„Ø£Ø­Ù…Ø± ÙØ§Ø²!";
        saveRoom();
        return;
      }
    } else if (clickedType === 'blue') {
      blueLeft--;
      if (blueLeft === 0) {
        gameEnded = true;
        alert("Ø§Ù„ÙØ±ÙŠÙ‚ Ø§Ù„Ø£Ø²Ø±Ù‚ ÙØ§Ø²! Ù…Ø¨Ø±ÙˆÙƒ!");
        statusDiv.textContent = "Ø§Ù†ØªÙ‡Øª Ø§Ù„Ù„Ø¹Ø¨Ø©. Ø§Ù„ÙØ±ÙŠÙ‚ Ø§Ù„Ø£Ø²Ø±Ù‚ ÙØ§Ø²!";
        saveRoom();
        return;
      }
    }
    // Ø§Ø°Ø§ Ø§Ù„ÙØ±ÙŠÙ‚ Ø¶ØºØ· Ø¹Ù„Ù‰ ÙƒÙ„Ù…Ø© ØºÙŠØ± ÙØ±ÙŠÙ‚Ù‡ØŒ ÙŠÙ†ØªÙ‚Ù„ Ø§Ù„Ø¯ÙˆØ± Ù„Ù„ÙØ±ÙŠÙ‚ Ø§Ù„Ø«Ø§Ù†ÙŠ
    if (clickedType !== turn && clickedType !== 'neutral' && clickedType !== 'assassin') {
      turn = turn === 'red' ? 'blue' : 'red';
    }
    updateStatus();
    saveRoom();
  }

  function updateStatus() {
    statusDiv.textContent = `Ø¯ÙˆØ± Ø§Ù„ÙØ±ÙŠÙ‚: ${turn === 'red' ? 'Ø§Ù„Ø£Ø­Ù…Ø± ğŸ”´' : 'Ø§Ù„Ø£Ø²Ø±Ù‚ ğŸ”µ'} - ÙƒÙ„Ù…Ø§Øª Ø§Ù„Ø£Ø­Ù…Ø± Ø§Ù„Ù…ØªØ¨Ù‚ÙŠØ©: ${redLeft} - ÙƒÙ„Ù…Ø§Øª Ø§Ù„Ø£Ø²Ø±Ù‚ Ø§Ù„Ù…ØªØ¨Ù‚ÙŠØ©: ${blueLeft}`;
  }

  // Ø¥Ù†Ø´Ø§Ø¡ Ù„Ø¹Ø¨Ø© Ø¬Ø¯ÙŠØ¯Ø© ÙˆØ±Ù‚Ù… Ø±ÙˆÙ… Ø¬Ø¯ÙŠØ¯
  function newGame() {
    roomId = generateRoomId();
    generateBoard();
    turn = 'red';
    redLeft = 9;
    blueLeft = 8;
    gameEnded = false;
    saveRoom();

    // Ø´Ø§Ø±Ùƒ Ø§Ù„Ø±Ø§Ø¨Ø· Ù…Ø¹ Ø§Ù„Ø±ÙˆÙ…
    const url = window.location.origin + window.location.pathname + '?room=' + roomId;
    linkBox.style.display = 'block';
    linkBox.textContent = 'Ø´Ø§Ø±Ùƒ Ù‡Ø°Ø§ Ø§Ù„Ø±Ø§Ø¨Ø· Ù…Ø¹ Ø±Ø¨Ø¹Ùƒ Ù„Ù„Ø§Ù†Ø¶Ù…Ø§Ù… Ù„Ù„Ø¹Ø¨Ø©:\n' + url;

    setupDiv.style.display = 'none';
    gameDiv.style.display = 'block';

    renderBoard();
    updateStatus();
    history.replaceState(null, '', '?room=' + roomId);
  }

  // ØªØ­Ù…ÙŠÙ„ Ù„Ø¹Ø¨Ø© Ù…ÙˆØ¬ÙˆØ¯Ø© Ù…Ù† URL
  function loadGameFromUrl() {
    const params = new URLSearchParams(window.location.search);
    const id = params.get('room');
    if (id) {
      const loaded = loadRoom(id);
      if (loaded) {
        roomId = id;
        setupDiv.style.display = 'none';
        gameDiv.style.display = 'block';
        linkBox.style.display = 'block';
        const url = window.location.origin + window.location.pathname + '?room=' + roomId;
        linkBox.textContent = 'Ø´Ø§Ø±Ùƒ Ù‡Ø°Ø§ Ø§Ù„Ø±Ø§Ø¨Ø· Ù…Ø¹ Ø±Ø¨Ø¹Ùƒ Ù„Ù„Ø§Ù†Ø¶Ù…Ø§Ù… Ù„Ù„Ø¹Ø¨Ø©:\n' + url;
        renderBoard();
        updateStatus();
        return true;
      }
    }
    return false;
  }

  // Ø¥Ø¹Ø§Ø¯Ø© ØªØ´ØºÙŠÙ„ Ù†ÙØ³ Ø§Ù„Ø±ÙˆÙ… (Ù†ÙØ³ Ø§Ù„ÙƒÙ„Ù…Ø§ØªØŒ Ø¥Ø¹Ø§Ø¯Ø© ØªØ¹ÙŠÙŠÙ†)
  function restartGame() {
    if (!roomId) return;
    generateBoard();
    turn = 'red';
    redLeft = 9;
    blueLeft = 8;
    gameEnded = false;
    saveRoom();
    renderBoard();
    updateStatus();
  }

  // Ø²Ø± Ø§Ù„Ø±Ø¬ÙˆØ¹ Ù„Ù„ØµÙØ­Ø© Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©
  function backToSetup() {
    roomId = null;
    setupDiv.style.display = 'block';
    gameDiv.style.display = 'none';
    linkBox.style.display = 'none';
    history.replaceState(null, '', window.location.pathname);
  }

  // Ø§Ù„Ø£Ø­Ø¯Ø§Ø«
  newGameBtn.onclick = newGame;
  restartBtn.onclick = restartGame;
  backBtn.onclick = backToSetup;

  // Ø§Ø°Ø§ ÙÙŠÙ‡ Ø±ÙˆÙ… ÙÙŠ Ø§Ù„Ø±Ø§Ø¨Ø· Ù†Ø­Ù…Ù‘Ù„Ù‡Ø§
  window.onload = () => {
    if(!loadGameFromUrl()) {
      setupDiv.style.display = 'block';
    }
  };
</script>

</body>
</html>
