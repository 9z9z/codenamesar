<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>ÙƒÙˆØ¯ Ù†Ø§ÙŠÙ…Ø² Ø£ÙˆÙ†Ù„Ø§ÙŠÙ†</title>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
    }
    
    body {
      background: linear-gradient(135deg, #1a2a6c 0%, #b21f1f 100%);
      min-height: 100vh;
      color: #fff;
      padding: 20px;
      display: flex;
      justify-content: center;
      align-items: center;
    }
    
    .container {
      max-width: 1200px;
      width: 100%;
      margin: 0 auto;
    }
    
    .header {
      text-align: center;
      margin-bottom: 30px;
      animation: fadeInDown 1s ease;
    }
    
    .header h1 {
      font-size: 3.2rem;
      font-weight: 800;
      margin-bottom: 10px;
      background: linear-gradient(45deg, #ffd700, #ff8c00);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
      text-shadow: 0 2px 10px rgba(0, 0, 0, 0.2);
    }
    
    .header p {
      font-size: 1.3rem;
      opacity: 0.9;
      max-width: 600px;
      margin: 0 auto;
      line-height: 1.6;
    }
    
    .game-container {
      display: grid;
      grid-template-columns: 1fr 350px;
      gap: 25px;
      margin-bottom: 30px;
    }
    
    .main-game {
      background: rgba(0, 0, 0, 0.25);
      backdrop-filter: blur(12px);
      border-radius: 25px;
      padding: 25px;
      border: 1px solid rgba(255, 255, 255, 0.15);
      box-shadow: 0 12px 40px rgba(0, 0, 0, 0.3);
    }
    
    .sidebar {
      display: flex;
      flex-direction: column;
      gap: 25px;
    }
    
    .panel {
      background: rgba(0, 0, 0, 0.25);
      backdrop-filter: blur(12px);
      border-radius: 20px;
      padding: 25px;
      border: 1px solid rgba(255, 255, 255, 0.15);
      box-shadow: 0 12px 40px rgba(0, 0, 0, 0.3);
    }
    
    .panel h3 {
      margin-bottom: 20px;
      color: #ffd700;
      text-shadow: 0 1px 3px rgba(0, 0, 0, 0.3);
      border-bottom: 2px solid rgba(255, 215, 0, 0.4);
      padding-bottom: 12px;
      font-size: 1.6rem;
    }
    
    .form-group {
      margin-bottom: 20px;
    }
    
    .form-group label {
      display: block;
      margin-bottom: 10px;
      font-weight: 600;
      color: #ffd700;
      font-size: 1.1rem;
    }
    
    .form-group input, .form-group select {
      width: 100%;
      padding: 14px;
      border: none;
      border-radius: 12px;
      background: rgba(255, 255, 255, 0.92);
      color: #222;
      font-size: 1.1rem;
      transition: all 0.3s ease;
      border: 2px solid transparent;
    }
    
    .form-group input:focus, .form-group select:focus {
      outline: none;
      background: rgba(255, 255, 255, 1);
      box-shadow: 0 0 0 4px rgba(255, 215, 0, 0.35);
      border-color: #ffd700;
    }
    
    .btn {
      padding: 14px 28px;
      border: none;
      border-radius: 12px;
      background: linear-gradient(45deg, #ff8c00, #ff4500);
      color: white;
      font-size: 1.1rem;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.3s ease;
      letter-spacing: 0.5px;
      box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
      display: inline-flex;
      align-items: center;
      justify-content: center;
      gap: 10px;
    }
    
    .btn:hover {
      transform: translateY(-4px);
      box-shadow: 0 8px 20px rgba(0, 0, 0, 0.3);
    }
    
    .btn:active {
      transform: translateY(0);
    }
    
    .btn-primary {
      background: linear-gradient(45deg, #4CAF50, #2E8B57);
    }
    
    .btn-secondary {
      background: linear-gradient(45deg, #2196F3, #1E90FF);
    }
    
    .btn-danger {
      background: linear-gradient(45deg, #f44336, #B22222);
    }
    
    .game-board {
      display: grid;
      grid-template-columns: repeat(5, 1fr);
      gap: 12px;
      margin: 30px 0;
    }
    
    .card {
      aspect-ratio: 1.4;
      background: rgba(255, 255, 255, 0.92);
      border-radius: 12px;
      display: flex;
      align-items: center;
      justify-content: center;
      font-weight: 700;
      font-size: 1.15rem;
      color: #222;
      cursor: pointer;
      transition: all 0.3s ease;
      user-select: none;
      border: 2px solid transparent;
      position: relative;
      overflow: hidden;
      text-align: center;
      padding: 10px;
      box-shadow: 0 5px 15px rgba(0, 0, 0, 0.15);
      text-shadow: 0 1px 2px rgba(0, 0, 0, 0.1);
    }
    
    .card:hover {
      transform: translateY(-6px);
      box-shadow: 0 10px 25px rgba(0, 0, 0, 0.25);
    }
    
    .card.red {
      background: linear-gradient(135deg, #ff6b6b, #c00000);
      color: white;
      border-color: #ff4757;
    }
    
    .card.blue {
      background: linear-gradient(135deg, #4834d4, #000080);
      color: white;
      border-color: #3742fa;
    }
    
    .card.neutral {
      background: linear-gradient(135deg, #a4b0be, #556677);
      color: white;
      border-color: #57606f;
    }
    
    .card.assassin {
      background: linear-gradient(135deg, #2c2c54, #000000);
      color: #ff3838;
      border-color: #ff3838;
      box-shadow: 0 0 25px rgba(255, 56, 56, 0.6);
    }
    
    .card.guessed {
      opacity: 0.7;
      transform: scale(0.95);
      cursor: default;
    }
    
    .card.guessed::after {
      content: 'âœ“';
      position: absolute;
      top: 8px;
      right: 8px;
      font-size: 1.8rem;
      color: #fff;
      text-shadow: 0 1px 3px rgba(0, 0, 0, 0.5);
      font-weight: bold;
    }
    
    .game-info {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 20px;
      padding: 20px;
      background: rgba(0, 0, 0, 0.3);
      border-radius: 15px;
      border: 1px solid rgba(255, 255, 255, 0.15);
    }
    
    .team-score {
      text-align: center;
      padding: 15px 25px;
      border-radius: 15px;
      background: rgba(0, 0, 0, 0.25);
      min-width: 140px;
      border: 1px solid rgba(255, 255, 255, 0.1);
    }
    
    .team-score .score {
      font-size: 2.8rem;
      font-weight: 800;
      margin-bottom: 8px;
      text-shadow: 0 0 15px rgba(255, 255, 255, 0.4);
    }
    
    .team-score.red .score {
      color: #ff6b6b;
    }
    
    .team-score.blue .score {
      color: #6a5acd;
    }
    
    .turn-indicator {
      font-size: 1.5rem;
      font-weight: 700;
      padding: 15px 30px;
      border-radius: 25px;
      background: rgba(255, 255, 255, 0.15);
      min-width: 230px;
      text-align: center;
      border: 2px solid rgba(255, 215, 0, 0.5);
      text-shadow: 0 1px 3px rgba(0, 0, 0, 0.3);
    }
    
    .chat-container {
      height: 320px;
      display: flex;
      flex-direction: column;
    }
    
    .chat-messages {
      flex: 1;
      background: rgba(0, 0, 0, 0.2);
      border-radius: 15px;
      padding: 15px;
      overflow-y: auto;
      margin-bottom: 15px;
      display: flex;
      flex-direction: column;
      gap: 10px;
    }
    
    .chat-message {
      padding: 12px;
      border-radius: 12px;
      background: rgba(255, 255, 255, 0.1);
      border-left: 4px solid #ffd700;
    }
    
    .chat-message .username {
      font-weight: 700;
      color: #ffd700;
      margin-bottom: 5px;
      display: block;
    }
    
    .chat-message .time {
      font-size: 0.85rem;
      opacity: 0.7;
      float: left;
    }
    
    .chat-input {
      display: flex;
      gap: 12px;
    }
    
    .chat-input input {
      flex: 1;
      padding: 14px;
      border: none;
      border-radius: 12px;
      background: rgba(255, 255, 255, 0.92);
      color: #222;
      border: 2px solid transparent;
      font-size: 1.05rem;
    }
    
    .chat-input input:focus {
      outline: none;
      border-color: #ffd700;
      box-shadow: 0 0 0 4px rgba(255, 215, 0, 0.3);
    }
    
    .players-list {
      background: rgba(0, 0, 0, 0.2);
      border-radius: 15px;
      padding: 15px;
      display: flex;
      flex-direction: column;
      gap: 12px;
    }
    
    .player-item {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 12px;
      background: rgba(255, 255, 255, 0.1);
      border-radius: 10px;
      border-left: 4px solid #ffd700;
    }
    
    .player-role {
      font-size: 0.9rem;
      padding: 6px 12px;
      border-radius: 12px;
      background: rgba(255, 215, 0, 0.2);
    }
    
    .controls {
      display: flex;
      gap: 15px;
      margin-top: 25px;
      flex-wrap: wrap;
      justify-content: center;
    }
    
    .winner-modal {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0, 0, 0, 0.95);
      display: flex;
      align-items: center;
      justify-content: center;
      z-index: 1000;
    }
    
    .winner-content {
      background: linear-gradient(135deg, #1a2a6c, #b21f1f);
      padding: 40px;
      border-radius: 25px;
      text-align: center;
      color: white;
      max-width: 550px;
      width: 90%;
      border: 4px solid #ffd700;
      box-shadow: 0 0 40px rgba(255, 215, 0, 0.6);
    }
    
    .winner-content h2 {
      font-size: 2.8rem;
      margin-bottom: 20px;
      color: #ffd700;
      text-shadow: 0 0 20px rgba(255, 215, 0, 0.7);
    }
    
    .winner-content p {
      font-size: 1.3rem;
      margin-bottom: 30px;
      line-height: 1.6;
    }
    
    .hidden {
      display: none;
    }
    
    .lobby-screen {
      text-align: center;
      padding: 30px;
      max-width: 650px;
      margin: 0 auto;
      background: rgba(0, 0, 0, 0.3);
      border-radius: 25px;
      backdrop-filter: blur(10px);
      border: 1px solid rgba(255, 255, 255, 0.15);
      box-shadow: 0 15px 35px rgba(0, 0, 0, 0.3);
    }
    
    .lobby-screen .btn {
      margin: 15px;
      min-width: 240px;
      padding: 16px;
    }
    
    .loading {
      text-align: center;
      padding: 30px;
      font-size: 1.3rem;
    }
    
    .loading-spinner {
      border: 5px solid rgba(255, 255, 255, 0.3);
      border-top: 5px solid #ffd700;
      border-radius: 50%;
      width: 60px;
      height: 60px;
      animation: spin 1s linear infinite;
      margin: 0 auto 20px;
    }
    
    .error-message {
      background: #ff6b6b;
      color: white;
      padding: 15px;
      border-radius: 10px;
      margin: 20px 0;
      text-align: center;
      font-weight: 700;
      font-size: 1.1rem;
    }
    
    .room-code-display {
      font-size: 1.7rem;
      margin: 20px 0;
      padding: 15px;
      background: rgba(0, 0, 0, 0.3);
      border-radius: 15px;
      border: 3px dashed #ffd700;
      font-weight: 700;
    }
    
    @keyframes fadeInDown {
      from {
        opacity: 0;
        transform: translateY(-40px);
      }
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }
    
    @keyframes pulse {
      0% {
        transform: scale(1);
      }
      50% {
        transform: scale(1.08);
      }
      100% {
        transform: scale(1);
      }
    }
    
    @keyframes spin {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }
    
    .card.highlight {
      animation: pulse 0.5s ease-in-out 2;
    }
    
    @media (max-width: 992px) {
      .game-container {
        grid-template-columns: 1fr;
      }
      
      .header h1 {
        font-size: 2.5rem;
      }
      
      .game-board {
        grid-template-columns: repeat(5, 1fr);
        gap: 8px;
      }
      
      .card {
        font-size: 1rem;
        padding: 8px;
      }
      
      .controls {
        flex-direction: column;
      }
      
      .game-info {
        flex-direction: column;
        gap: 20px;
      }
      
      .team-score {
        width: 100%;
      }
    }
    
    @media (max-width: 576px) {
      .header h1 {
        font-size: 2rem;
      }
      
      .header p {
        font-size: 1.1rem;
      }
      
      .game-board {
        grid-template-columns: repeat(4, 1fr);
      }
      
      .card {
        aspect-ratio: 1.3;
        font-size: 0.9rem;
      }
      
      .btn {
        width: 100%;
      }
    }
  </style>
  
  <!-- Firebase SDK -->
  <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-database-compat.js"></script>
</head>
<body>
  <div class="container">
    <div class="header">
      <h1>ğŸ¯ ÙƒÙˆØ¯ Ù†Ø§ÙŠÙ…Ø² Ø£ÙˆÙ†Ù„Ø§ÙŠÙ†</h1>
      <p>Ù„Ø¹Ø¨Ø© Ø§Ù„ØªØ®Ù…ÙŠÙ† ÙˆØ§Ù„Ø§Ø³ØªØ±Ø§ØªÙŠØ¬ÙŠØ© Ø§Ù„Ø¬Ù…Ø§Ø¹ÙŠØ© - Ø§Ù„Ø¹Ø¨ Ù…Ø¹ Ø£ØµØ¯Ù‚Ø§Ø¦Ùƒ ÙÙŠ Ø§Ù„ÙˆÙ‚Øª Ø§Ù„Ø­Ù‚ÙŠÙ‚ÙŠ</p>
    </div>

    <!-- Loading Screen -->
    <div id="loadingScreen" class="loading hidden">
      <div class="loading-spinner"></div>
      <p>Ø¬Ø§Ø±ÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù„Ø¹Ø¨Ø©...</p>
    </div>

    <!-- Lobby Screen -->
    <div id="lobbyScreen" class="lobby-screen">
      <div class="panel">
        <h3>Ø§Ù†Ø¶Ù… Ø¥Ù„Ù‰ Ø§Ù„Ù„Ø¹Ø¨Ø©</h3>
        <div id="errorContainer"></div>
        <div class="form-group">
          <label for="playerName">Ø§Ø³Ù… Ø§Ù„Ù„Ø§Ø¹Ø¨:</label>
          <input type="text" id="playerName" placeholder="Ø£Ø¯Ø®Ù„ Ø§Ø³Ù…Ùƒ" value="Ø§Ù„Ù„Ø§Ø¹Ø¨">
        </div>
        <div class="form-group">
          <label for="roomCode">ÙƒÙˆØ¯ Ø§Ù„ØºØ±ÙØ©:</label>
          <input type="text" id="roomCode" placeholder="Ø£Ø¯Ø®Ù„ ÙƒÙˆØ¯ Ø§Ù„ØºØ±ÙØ©">
        </div>
        <div class="form-group">
          <label for="playerRole">Ø¯ÙˆØ±Ùƒ ÙÙŠ Ø§Ù„Ù„Ø¹Ø¨Ø©:</label>
          <select id="playerRole">
            <option value="field_red">Ø¹Ù…ÙŠÙ„ Ù…ÙŠØ¯Ø§Ù†ÙŠ - Ø§Ù„ÙØ±ÙŠÙ‚ Ø§Ù„Ø£Ø­Ù…Ø±</option>
            <option value="spy_red">Ø±Ø¦ÙŠØ³ Ø§Ù„Ø¬ÙˆØ§Ø³ÙŠØ³ - Ø§Ù„ÙØ±ÙŠÙ‚ Ø§Ù„Ø£Ø­Ù…Ø±</option>
            <option value="field_blue">Ø¹Ù…ÙŠÙ„ Ù…ÙŠØ¯Ø§Ù†ÙŠ - Ø§Ù„ÙØ±ÙŠÙ‚ Ø§Ù„Ø£Ø²Ø±Ù‚</option>
            <option value="spy_blue">Ø±Ø¦ÙŠØ³ Ø§Ù„Ø¬ÙˆØ§Ø³ÙŠØ³ - Ø§Ù„ÙØ±ÙŠÙ‚ Ø§Ù„Ø£Ø²Ø±Ù‚</option>
          </select>
        </div>
        <button class="btn btn-primary" id="joinGameBtn">Ø§Ù†Ø¶Ù… Ø¥Ù„Ù‰ Ø§Ù„Ù„Ø¹Ø¨Ø©</button>
        <button class="btn btn-secondary" id="createRoomBtn">Ø¥Ù†Ø´Ø§Ø¡ ØºØ±ÙØ© Ø¬Ø¯ÙŠØ¯Ø©</button>
        <div id="roomCodeDisplay" class="room-code-display hidden"></div>
      </div>
    </div>

    <!-- Game Screen -->
    <div id="gameScreen" class="game-container hidden">
      <div class="main-game">
        <div class="game-info">
          <div class="team-score red">
            <div class="score" id="redScore">9</div>
            <div>Ø§Ù„ÙØ±ÙŠÙ‚ Ø§Ù„Ø£Ø­Ù…Ø±</div>
          </div>
          <div class="turn-indicator" id="turnIndicator">
            Ø¯ÙˆØ± Ø§Ù„ÙØ±ÙŠÙ‚ Ø§Ù„Ø£Ø­Ù…Ø±
          </div>
          <div class="team-score blue">
            <div class="score" id="blueScore">8</div>
            <div>Ø§Ù„ÙØ±ÙŠÙ‚ Ø§Ù„Ø£Ø²Ø±Ù‚</div>
          </div>
        </div>
        
        <div class="game-board" id="gameBoard">
          <!-- Cards will be generated here -->
        </div>
        
        <div class="controls">
          <button class="btn btn-secondary" id="spymasterBtn">
            <span>ğŸ‘ï¸</span> ØªØ´ØºÙŠÙ„ ÙˆØ¶Ø¹ Ø±Ø¦ÙŠØ³ Ø§Ù„Ø¬ÙˆØ§Ø³ÙŠØ³
          </button>
          <button class="btn btn-danger" id="passTurnBtn">
            <span>â¡ï¸</span> ØªÙ…Ø±ÙŠØ± Ø§Ù„Ø¯ÙˆØ±
          </button>
          <button class="btn btn-primary" id="newGameBtn">
            <span>ğŸ”„</span> Ù„Ø¹Ø¨Ø© Ø¬Ø¯ÙŠØ¯Ø©
          </button>
        </div>
      </div>

      <div class="sidebar">
        <div class="panel">
          <h3>Ø§Ù„Ù„Ø§Ø¹Ø¨ÙˆÙ† (<span id="playersCount">0</span>)</h3>
          <div class="players-list" id="playersList">
            <!-- Players will be listed here -->
          </div>
        </div>

        <div class="panel">
          <h3>Ø§Ù„Ø¯Ø±Ø¯Ø´Ø©</h3>
          <div class="chat-container">
            <div class="chat-messages" id="chatMessages">
              <!-- Chat messages will appear here -->
            </div>
            <div class="chat-input">
              <input type="text" id="chatInput" placeholder="Ø§ÙƒØªØ¨ Ø±Ø³Ø§Ù„Ø©...">
              <button class="btn" id="sendMessageBtn">Ø¥Ø±Ø³Ø§Ù„</button>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Winner Modal -->
    <div id="winnerModal" class="winner-modal hidden">
      <div class="winner-content">
        <h2 id="winnerText">ğŸ‰ Ø§Ù„ÙØ±ÙŠÙ‚ Ø§Ù„Ø£Ø­Ù…Ø± ÙŠÙÙˆØ²!</h2>
        <p>ØªÙ‡Ø§Ù†ÙŠÙ†Ø§ Ø¹Ù„Ù‰ Ø§Ù„ÙÙˆØ²! Ù„Ù‚Ø¯ Ø£Ø«Ø¨ØªÙ… Ù…Ù‡Ø§Ø±ØªÙƒÙ… ÙÙŠ Ø§Ù„ØªØ®Ù…ÙŠÙ† ÙˆØ§Ù„Ø§Ø³ØªØ±Ø§ØªÙŠØ¬ÙŠØ©</p>
        <div class="controls" style="justify-content: center; margin-top: 30px;">
          <button class="btn btn-primary" id="closeWinnerBtn">Ø¥ØºÙ„Ø§Ù‚</button>
          <button class="btn btn-secondary" id="newGameModalBtn">Ù„Ø¹Ø¨Ø© Ø¬Ø¯ÙŠØ¯Ø©</button>
        </div>
      </div>
    </div>
  </div>

  <script>
    // Firebase configuration
    const firebaseConfig = {
      apiKey: "AIzaSyDTAqaqpmPX0JYie21Gl2ysp1mHgKuw2EY",
      authDomain: "myupload-948bd.firebaseapp.com",
      projectId: "myupload-948bd",
      storageBucket: "myupload-948bd.appspot.com",
      messagingSenderId: "451397571101",
      appId: "1:451397571101:web:90b7cf96637819f734ecf4"
    };

    // Initialize Firebase
    const app = firebase.initializeApp(firebaseConfig);
    const database = firebase.database();

    // Game state
    let gameState = {
      players: {},
      cards: [],
      currentTurn: 'red',
      redScore: 9,
      blueScore: 8,
      winner: null,
      currentPlayer: null,
      roomCode: null,
      playerId: null,
      playerRole: null,
      isRoomCreator: false
    };

    // Local state for spymaster mode
    let spymasterMode = false;

    // Sample Arabic words for the game
    const arabicWords = [
      'Ø´Ù…Ø³', 'Ù‚Ù…Ø±', 'Ù†Ø¬Ù…', 'Ø¨Ø­Ø±', 'Ø¬Ø¨Ù„', 'Ù†Ù‡Ø±', 'Ø´Ø¬Ø±Ø©', 'ÙˆØ±Ø¯Ø©', 'Ø·Ø§Ø¦Ø±', 'Ù‚Ø·',
      'ÙƒÙ„Ø¨', 'Ø­ØµØ§Ù†', 'Ø³ÙŠØ§Ø±Ø©', 'Ø·Ø§Ø¦Ø±Ø©', 'Ù‚Ø·Ø§Ø±', 'Ø¨ÙŠØª', 'Ù…Ø¯Ø±Ø³Ø©', 'Ù…Ø³Ø¬Ø¯', 'Ù…ÙƒØªØ¨Ø©', 'Ø³ÙˆÙ‚',
      'Ø·Ø¨ÙŠØ¨', 'Ù…Ù‡Ù†Ø¯Ø³', 'Ù…Ø¹Ù„Ù…', 'Ø·Ø¨Ø§Ø®', 'Ø±Ø³Ø§Ù…', 'ÙƒØªØ§Ø¨', 'Ù‚Ù„Ù…', 'ÙˆØ±Ù‚Ø©', 'Ø­Ø§Ø³ÙˆØ¨', 'Ù‡Ø§ØªÙ',
      'ØªÙ„ÙØ§Ø²', 'Ø±Ø§Ø¯ÙŠÙˆ', 'Ù…ÙˆØ³ÙŠÙ‚Ù‰', 'ÙÙŠÙ„Ù…', 'Ù„Ø¹Ø¨Ø©', 'ÙƒØ±Ø©', 'Ù…Ù„Ø¹Ø¨', 'Ø­Ø¯ÙŠÙ‚Ø©', 'Ù…Ù‚Ù‡Ù‰', 'Ù…Ø·Ø¹Ù…',
      'Ø®Ø¨Ø²', 'Ù…Ø§Ø¡', 'Ø´Ø§ÙŠ', 'Ù‚Ù‡ÙˆØ©', 'Ø¹Ø³Ù„', 'ØªÙØ§Ø­', 'Ø¨Ø±ØªÙ‚Ø§Ù„', 'Ù…ÙˆØ²', 'Ø¹Ù†Ø¨', 'ÙØ±Ø§ÙˆÙ„Ø©'
    ];

    // DOM Elements
    const elements = {
      lobbyScreen: document.getElementById('lobbyScreen'),
      gameScreen: document.getElementById('gameScreen'),
      loadingScreen: document.getElementById('loadingScreen'),
      winnerModal: document.getElementById('winnerModal'),
      gameBoard: document.getElementById('gameBoard'),
      playersList: document.getElementById('playersList'),
      chatMessages: document.getElementById('chatMessages'),
      playerName: document.getElementById('playerName'),
      roomCode: document.getElementById('roomCode'),
      playerRole: document.getElementById('playerRole'),
      redScore: document.getElementById('redScore'),
      blueScore: document.getElementById('blueScore'),
      turnIndicator: document.getElementById('turnIndicator'),
      winnerText: document.getElementById('winnerText'),
      errorContainer: document.getElementById('errorContainer'),
      createRoomBtn: document.getElementById('createRoomBtn'),
      joinGameBtn: document.getElementById('joinGameBtn'),
      spymasterBtn: document.getElementById('spymasterBtn'),
      passTurnBtn: document.getElementById('passTurnBtn'),
      newGameBtn: document.getElementById('newGameBtn'),
      newGameModalBtn: document.getElementById('newGameModalBtn'),
      closeWinnerBtn: document.getElementById('closeWinnerBtn'),
      sendMessageBtn: document.getElementById('sendMessageBtn'),
      chatInput: document.getElementById('chatInput'),
      roomCodeDisplay: document.getElementById('roomCodeDisplay'),
      playersCount: document.getElementById('playersCount')
    };

    // Initialize Firebase and game
    function initializeGame() {
      showLoading();
      
      // Generate unique player ID
      gameState.playerId = generatePlayerId();
      
      if (gameState.isRoomCreator) {
        // Room creator - generate cards and set initial state
        generateCards();
        saveGameState();
        addChatMessage('Ø§Ù„Ù†Ø¸Ø§Ù…', 'ØªÙ… Ø¥Ù†Ø´Ø§Ø¡ ØºØ±ÙØ© Ø¬Ø¯ÙŠØ¯Ø©!');
      }
      
      // Listen for game state changes
      database.ref(`rooms/${gameState.roomCode}/state`).on('value', (snapshot) => {
        const state = snapshot.val();
        if (state) {
          gameState.cards = state.cards || [];
          gameState.currentTurn = state.currentTurn || 'red';
          gameState.redScore = state.redScore || 9;
          gameState.blueScore = state.blueScore || 8;
          gameState.winner = state.winner || null;
          
          updateDisplay();
          
          // Show winner if exists
          if (gameState.winner) {
            showWinner();
          }
        }
      });
      
      // Listen for player list changes
      database.ref(`rooms/${gameState.roomCode}/players`).on('value', (snapshot) => {
        const players = snapshot.val();
        if (players) {
          gameState.players = players;
          updatePlayersList();
          elements.playersCount.textContent = Object.keys(players).length;
        }
      });
      
      // Listen for chat messages
      database.ref(`rooms/${gameState.roomCode}/chat`).on('child_added', (snapshot) => {
        const msg = snapshot.val();
        if (msg) {
          addChatMessage(msg.sender, msg.text);
        }
      });
      
      hideLoading();
    }

    // Generate unique player ID
    function generatePlayerId() {
      return 'player_' + Math.random().toString(36).substr(2, 9);
    }

    // Generate random cards
    function generateCards() {
      const shuffledWords = [...arabicWords].sort(() => 0.5 - Math.random()).slice(0, 25);
      const colors = [
        'red', 'red', 'red', 'red', 'red', 'red', 'red', 'red', 'red',
        'blue', 'blue', 'blue', 'blue', 'blue', 'blue', 'blue', 'blue',
        'neutral', 'neutral', 'neutral', 'neutral', 'neutral', 'neutral', 'neutral',
        'assassin'
      ];
      
      // Shuffle colors
      for (let i = colors.length - 1; i > 0; i--) {
        const j = Math.floor(Math.random() * (i + 1));
        [colors[i], colors[j]] = [colors[j], colors[i]];
      }

      gameState.cards = shuffledWords.map((word, index) => ({
        word: word,
        color: colors[index],
        revealed: false,
        id: index
      }));
    }

    // Save game state to Firebase
    function saveGameState() {
      if (!gameState.roomCode) return;
      
      const stateRef = database.ref(`rooms/${gameState.roomCode}/state`);
      stateRef.set({
        cards: gameState.cards,
        currentTurn: gameState.currentTurn,
        redScore: gameState.redScore,
        blueScore: gameState.blueScore,
        winner: gameState.winner
      });
    }

    // Save player state to Firebase
    function savePlayerState() {
      if (!gameState.roomCode || !gameState.playerId) return;
      
      const playerRef = database.ref(`rooms/${gameState.roomCode}/players/${gameState.playerId}`);
      playerRef.set({
        name: gameState.currentPlayer,
        role: gameState.playerRole,
        team: gameState.playerRole.includes('red') ? 'red' : 'blue',
        type: gameState.playerRole.includes('spy') ? 'spy' : 'field'
      });
    }

    // Create room
    function createRoom() {
      const playerName = elements.playerName.value.trim();
      if (!playerName) {
        showError('ÙŠØ±Ø¬Ù‰ Ø¥Ø¯Ø®Ø§Ù„ Ø§Ø³Ù… Ø§Ù„Ù„Ø§Ø¹Ø¨');
        return;
      }
      
      showLoading();
      
      const roomCode = Math.random().toString(36).substring(2, 8).toUpperCase();
      elements.roomCode.value = roomCode;
      gameState.roomCode = roomCode;
      gameState.currentPlayer = playerName;
      gameState.playerRole = elements.playerRole.value;
      gameState.isRoomCreator = true;
      
      // Set current player locally
      gameState.players[gameState.playerId] = {
        name: gameState.currentPlayer,
        role: gameState.playerRole,
        team: gameState.playerRole.includes('red') ? 'red' : 'blue',
        type: gameState.playerRole.includes('spy') ? 'spy' : 'field'
      };
      
      // Show room code
      elements.roomCodeDisplay.textContent = `ÙƒÙˆØ¯ Ø§Ù„ØºØ±ÙØ©: ${roomCode}`;
      elements.roomCodeDisplay.classList.remove('hidden');
      
      // Initialize room in Firebase
      database.ref(`rooms/${roomCode}`).set({
        created: new Date().toISOString()
      }).then(() => {
        savePlayerState();
        elements.lobbyScreen.classList.add('hidden');
        elements.gameScreen.classList.remove('hidden');
        initializeGame();
      }).catch((error) => {
        console.error("Error creating room: ", error);
        hideLoading();
        showError('Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„ØºØ±ÙØ©');
      });
    }

    // Join game
    function joinGame() {
      const playerName = elements.playerName.value.trim();
      const roomCode = elements.roomCode.value.trim().toUpperCase();
      const playerRole = elements.playerRole.value;

      if (!playerName) {
        showError('ÙŠØ±Ø¬Ù‰ Ø¥Ø¯Ø®Ø§Ù„ Ø§Ø³Ù… Ø§Ù„Ù„Ø§Ø¹Ø¨');
        return;
      }
      
      if (!roomCode) {
        showError('ÙŠØ±Ø¬Ù‰ Ø¥Ø¯Ø®Ø§Ù„ ÙƒÙˆØ¯ Ø§Ù„ØºØ±ÙØ©');
        return;
      }
      
      showLoading();
      
      // Check if room exists
      database.ref(`rooms/${roomCode}`).once('value').then((snapshot) => {
        if (snapshot.exists()) {
          gameState.roomCode = roomCode;
          gameState.currentPlayer = playerName;
          gameState.playerRole = playerRole;
          gameState.isRoomCreator = false;
          
          // Set current player locally
          gameState.players[gameState.playerId] = {
            name: gameState.currentPlayer,
            role: gameState.playerRole,
            team: gameState.playerRole.includes('red') ? 'red' : 'blue',
            type: gameState.playerRole.includes('spy') ? 'spy' : 'field'
          };
          
          savePlayerState();
          elements.lobbyScreen.classList.add('hidden');
          elements.gameScreen.classList.remove('hidden');
          initializeGame();
        } else {
          hideLoading();
          showError('ÙƒÙˆØ¯ Ø§Ù„ØºØ±ÙØ© ØºÙŠØ± ØµØ­ÙŠØ­!');
        }
      }).catch((error) => {
        console.error("Error joining room: ", error);
        hideLoading();
        showError('Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ Ø§Ù„Ø§Ù†Ø¶Ù…Ø§Ù… Ù„Ù„ØºØ±ÙØ©');
      });
    }

    // Update display
    function updateDisplay() {
      updateBoard();
      updateScores();
      updateTurnIndicator();
      updatePlayersList();
    }

    // Update game board
    function updateBoard() {
      elements.gameBoard.innerHTML = '';

      gameState.cards.forEach(card => {
        const cardElement = document.createElement('div');
        cardElement.className = 'card';
        cardElement.textContent = card.word;
        cardElement.dataset.id = card.id;

        if (card.revealed) {
          cardElement.classList.add('guessed', card.color);
        } else if (spymasterMode && isSpymaster()) {
          cardElement.classList.add(card.color);
          cardElement.style.cursor = 'default';
        } else {
          // Only add click event for unrevealed cards
          cardElement.addEventListener('click', () => selectCard(card.id));
        }

        elements.gameBoard.appendChild(cardElement);
      });
    }

    // Select card
    function selectCard(cardId) {
      const card = gameState.cards[cardId];
      if (card.revealed || gameState.winner) return;

      const currentPlayer = gameState.players[gameState.playerId];
      if (!currentPlayer) return;

      // Only field operatives can select cards
      if (currentPlayer.type === 'spy') {
        showError('Ø±Ø¦ÙŠØ³ Ø§Ù„Ø¬ÙˆØ§Ø³ÙŠØ³ Ù„Ø§ ÙŠÙ…ÙƒÙ†Ù‡ Ø§Ø®ØªÙŠØ§Ø± Ø§Ù„Ø¨Ø·Ø§Ù‚Ø§Øª');
        return;
      }

      // Check if it's the player's team turn
      if (currentPlayer.team !== gameState.currentTurn) {
        showError('Ù„ÙŠØ³ Ø¯ÙˆØ± ÙØ±ÙŠÙ‚Ùƒ');
        return;
      }

      card.revealed = true;
      
      // Add highlight effect
      const cardElement = document.querySelector(`.card[data-id="${cardId}"]`);
      if (cardElement) {
        cardElement.classList.add('highlight');
      }

      // Check card type and handle accordingly
      if (card.color === 'assassin') {
        gameState.winner = currentPlayer.team === 'red' ? 'blue' : 'red';
        addChatMessage('Ø§Ù„Ù†Ø¸Ø§Ù…', `ğŸ’€ ØªÙ… Ø§Ø®ØªÙŠØ§Ø± Ø¨Ø·Ø§Ù‚Ø© Ø§Ù„Ù‚Ø§ØªÙ„! ÙØ§Ø² Ø§Ù„ÙØ±ÙŠÙ‚ ${gameState.winner === 'red' ? 'Ø§Ù„Ø£Ø­Ù…Ø±' : 'Ø§Ù„Ø£Ø²Ø±Ù‚'}`);
        showWinner();
      } else if (card.color === currentPlayer.team) {
        // Correct team card
        if (currentPlayer.team === 'red') {
          gameState.redScore--;
        } else {
          gameState.blueScore--;
        }
        addChatMessage('Ø§Ù„Ù†Ø¸Ø§Ù…', `âœ… ${currentPlayer.name} Ø§Ø®ØªØ§Ø± Ø¨Ø·Ø§Ù‚Ø© ØµØ­ÙŠØ­Ø©: ${card.word}`);
        
        // Check for win
        if (gameState.redScore === 0) {
          gameState.winner = 'red';
          showWinner();
        } else if (gameState.blueScore === 0) {
          gameState.winner = 'blue';
          showWinner();
        }
      } else {
        // Wrong team card or neutral
        addChatMessage('Ø§Ù„Ù†Ø¸Ø§Ù…', `âŒ ${currentPlayer.name} Ø§Ø®ØªØ§Ø± Ø¨Ø·Ø§Ù‚Ø© Ø®Ø§Ø·Ø¦Ø©: ${card.word}`);
        switchTurn();
      }

      saveGameState();
      updateDisplay();
    }

    // Switch turn
    function switchTurn() {
      gameState.currentTurn = gameState.currentTurn === 'red' ? 'blue' : 'red';
      saveGameState();
    }

    // Toggle spymaster mode
    function toggleSpymaster() {
      const currentPlayer = gameState.players[gameState.playerId];
      if (!currentPlayer) return;

      if (currentPlayer.type !== 'spy') {
        showError('ÙÙ‚Ø· Ø±Ø¦ÙŠØ³ Ø§Ù„Ø¬ÙˆØ§Ø³ÙŠØ³ ÙŠÙ…ÙƒÙ†Ù‡ Ø§Ø³ØªØ®Ø¯Ø§Ù… Ù‡Ø°Ø§ Ø§Ù„ÙˆØ¶Ø¹');
        return;
      }

      spymasterMode = !spymasterMode;
      elements.spymasterBtn.textContent = spymasterMode ? 
        'ğŸ‘ï¸ Ø¥ÙŠÙ‚Ø§Ù ÙˆØ¶Ø¹ Ø±Ø¦ÙŠØ³ Ø§Ù„Ø¬ÙˆØ§Ø³ÙŠØ³' : 
        'ğŸ‘ï¸ ØªØ´ØºÙŠÙ„ ÙˆØ¶Ø¹ Ø±Ø¦ÙŠØ³ Ø§Ù„Ø¬ÙˆØ§Ø³ÙŠØ³';
      
      updateBoard();
    }

    // Check if current player is spymaster
    function isSpymaster() {
      const currentPlayer = gameState.players[gameState.playerId];
      return currentPlayer && currentPlayer.type === 'spy';
    }

    // Pass turn
    function passTurn() {
      const currentPlayer = gameState.players[gameState.playerId];
      if (!currentPlayer) return;

      if (currentPlayer.team !== gameState.currentTurn) {
        showError('Ù„ÙŠØ³ Ø¯ÙˆØ± ÙØ±ÙŠÙ‚Ùƒ');
        return;
      }

      switchTurn();
      addChatMessage('Ø§Ù„Ù†Ø¸Ø§Ù…', `${currentPlayer.name} Ù…Ø±Ø± Ø§Ù„Ø¯ÙˆØ±`);
      updateDisplay();
    }

    // Update scores
    function updateScores() {
      elements.redScore.textContent = gameState.redScore;
      elements.blueScore.textContent = gameState.blueScore;
    }

    // Update turn indicator
    function updateTurnIndicator() {
      elements.turnIndicator.textContent = `Ø¯ÙˆØ± Ø§Ù„ÙØ±ÙŠÙ‚ ${gameState.currentTurn === 'red' ? 'Ø§Ù„Ø£Ø­Ù…Ø±' : 'Ø§Ù„Ø£Ø²Ø±Ù‚'}`;
      elements.turnIndicator.style.backgroundColor = gameState.currentTurn === 'red' ? 
        'rgba(255, 107, 107, 0.3)' : 'rgba(72, 52, 212, 0.3)';
    }

    // Update players list
    function updatePlayersList() {
      elements.playersList.innerHTML = '';

      Object.values(gameState.players).forEach(player => {
        const playerDiv = document.createElement('div');
        playerDiv.className = 'player-item';
        
        const nameSpan = document.createElement('span');
        nameSpan.textContent = player.name;
        
        const roleSpan = document.createElement('span');
        roleSpan.className = 'player-role';
        roleSpan.textContent = `${player.type === 'spy' ? 'Ø±Ø¦ÙŠØ³ Ø¬ÙˆØ§Ø³ÙŠØ³' : 'Ø¹Ù…ÙŠÙ„ Ù…ÙŠØ¯Ø§Ù†ÙŠ'} - ${player.team === 'red' ? 'Ø£Ø­Ù…Ø±' : 'Ø£Ø²Ø±Ù‚'}`;
        roleSpan.style.color = player.team === 'red' ? '#ff6b6b' : '#6a5acd';
        
        playerDiv.appendChild(nameSpan);
        playerDiv.appendChild(roleSpan);
        elements.playersList.appendChild(playerDiv);
      });
    }

    // Show winner
    function showWinner() {
      elements.winnerText.textContent = `ğŸ‰ Ø§Ù„ÙØ±ÙŠÙ‚ ${gameState.winner === 'red' ? 'Ø§Ù„Ø£Ø­Ù…Ø±' : 'Ø§Ù„Ø£Ø²Ø±Ù‚'} ÙŠÙÙˆØ²!`;
      elements.winnerText.style.color = gameState.winner === 'red' ? '#ff6b6b' : '#6a5acd';
      elements.winnerModal.classList.remove('hidden');
      saveGameState();
    }

    // Close winner modal
    function closeWinnerModal() {
      elements.winnerModal.classList.add('hidden');
    }

    // New game
    function newGame() {
      if (!gameState.isRoomCreator) {
        showError('ÙÙ‚Ø· Ù…Ù†Ø´Ø¦ Ø§Ù„ØºØ±ÙØ© ÙŠÙ…ÙƒÙ†Ù‡ Ø¨Ø¯Ø¡ Ù„Ø¹Ø¨Ø© Ø¬Ø¯ÙŠØ¯Ø©');
        return;
      }
      
      showLoading();
      
      gameState.cards = [];
      gameState.currentTurn = 'red';
      gameState.redScore = 9;
      gameState.blueScore = 8;
      gameState.winner = null;
      spymasterMode = false;
      
      elements.spymasterBtn.textContent = 'ğŸ‘ï¸ ØªØ´ØºÙŠÙ„ ÙˆØ¶Ø¹ Ø±Ø¦ÙŠØ³ Ø§Ù„Ø¬ÙˆØ§Ø³ÙŠØ³';
      
      generateCards();
      saveGameState();
      addChatMessage('Ø§Ù„Ù†Ø¸Ø§Ù…', 'Ø¨Ø¯Ø£Øª Ù„Ø¹Ø¨Ø© Ø¬Ø¯ÙŠØ¯Ø©!');
      
      hideLoading();
      closeWinnerModal();
    }

    // Chat functionality
    function sendMessage() {
      const message = elements.chatInput.value.trim();
      
      if (message && gameState.currentPlayer) {
        const chatRef = database.ref(`rooms/${gameState.roomCode}/chat`);
        chatRef.push({
          sender: gameState.currentPlayer,
          text: message,
          timestamp: new Date().getTime()
        });
        
        elements.chatInput.value = '';
      }
    }

    function addChatMessage(sender, message) {
      const messageDiv = document.createElement('div');
      messageDiv.className = 'chat-message';
      
      const time = new Date().toLocaleTimeString('ar-SA', { 
        hour: '2-digit', 
        minute: '2-digit' 
      });
      
      messageDiv.innerHTML = `
        <div>
          <span class="username">${sender}</span>
          <span class="time">${time}</span>
        </div>
        <div>${message}</div>
      `;
      
      elements.chatMessages.appendChild(messageDiv);
      elements.chatMessages.scrollTop = elements.chatMessages.scrollHeight;
    }

    // Show error message
    function showError(message) {
      elements.errorContainer.innerHTML = `<div class="error-message">${message}</div>`;
      setTimeout(() => {
        elements.errorContainer.innerHTML = '';
      }, 4000);
    }

    // Show loading screen
    function showLoading() {
      elements.loadingScreen.classList.remove('hidden');
    }

    // Hide loading screen
    function hideLoading() {
      elements.loadingScreen.classList.add('hidden');
    }

    // Initialize event listeners
    function initEventListeners() {
      elements.createRoomBtn.addEventListener('click', createRoom);
      elements.joinGameBtn.addEventListener('click', joinGame);
      elements.spymasterBtn.addEventListener('click', toggleSpymaster);
      elements.passTurnBtn.addEventListener('click', passTurn);
      elements.newGameBtn.addEventListener('click', newGame);
      elements.newGameModalBtn.addEventListener('click', newGame);
      elements.closeWinnerBtn.addEventListener('click', closeWinnerModal);
      elements.sendMessageBtn.addEventListener('click', sendMessage);
      
      elements.chatInput.addEventListener('keypress', (e) => {
        if (e.key === 'Enter') {
          sendMessage();
        }
      });
    }

    // Initialize on page load
    document.addEventListener('DOMContentLoaded', () => {
      initEventListeners();
      
      // Add demo chat messages
      setTimeout(() => {
        addChatMessage('Ø§Ù„Ù†Ø¸Ø§Ù…', 'Ù…Ø±Ø­Ø¨Ø§Ù‹ Ø¨ÙƒÙ… ÙÙŠ Ù„Ø¹Ø¨Ø© ÙƒÙˆØ¯ Ù†Ø§ÙŠÙ…Ø² Ø£ÙˆÙ†Ù„Ø§ÙŠÙ†!');
        addChatMessage('Ø§Ù„Ù†Ø¸Ø§Ù…', 'Ø§Ù†Ø¶Ù… Ø¥Ù„Ù‰ ØºØ±ÙØ© Ø£Ùˆ Ø£Ù†Ø´Ø¦ ØºØ±ÙØ© Ø¬Ø¯ÙŠØ¯Ø© Ù„ØªØ¨Ø¯Ø£ Ø§Ù„Ù„Ø¹Ø¨');
      }, 500);
    });
  </script>
</body>
</html>
